name: Mirror to Personal Repo

on: [push]

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Setup GitHub CLI
        run: |
          # Install GitHub CLI (usually pre-installed on GitHub runners)
          sudo apt-get update
          sudo apt-get install gh -y
      
      - name: Authenticate with token
        env:
          GH_TOKEN: ${{ secrets.PERSONAL_REPO_TOKEN }}
        run: |
          # Test authentication
          gh auth status
          gh repo view MarcoAtefCosman/autonomous-navigation-robile --json name || echo "Repo might not exist"
      
      - name: Mirror using git commands with explicit auth
        env:
          GH_TOKEN: ${{ secrets.PERSONAL_REPO_TOKEN }}
        run: |
          # Clone the personal repo using token authentication
          git clone https://MarcoAtefCosman:${GH_TOKEN}@github.com/MarcoAtefCosman/autonomous-navigation-robile.git personal-repo
          
          # Copy all objects from current repo
          cd personal-repo
          git fetch --tags --force ../ "refs/heads/*:refs/heads/*"
          
          # Push everything back
          git push --tags --force --prune origin "refs/heads/*"
