name: Mirror to Personal Repo

on: [push]

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Full mirror to personal repo
        env:
          TOKEN: ${{ secrets.PERSONAL_REPO_TOKEN }}
        run: |
          # Configure git
          git config --global user.name "MarcoAtefCosman"
          git config --global user.email "your-email@example.com"
          
          # Create a temporary directory for mirroring
          mkdir -p /tmp/mirror
          cd /tmp/mirror
          
          # Clone the personal repo as a bare repository
          echo "Cloning personal repo..."
          git clone --bare https://MarcoAtefCosman:${TOKEN}@github.com/MarcoAtefCosman/autonomous-navigation-robile.git
          
          # Go into the bare repo
          cd autonomous-navigation-robile.git
          
          # Fetch everything from the source repo
          echo "Fetching from source..."
          git fetch --tags --force /home/runner/work/amr-ws25-projects-amr-ws26-perception/amr-ws25-projects-amr-ws26-perception "refs/heads/*:refs/heads/*"
          
          # Push everything back to personal repo
          echo "Pushing to personal repo..."
          git push --tags --force --prune origin "refs/heads/*"
          
          echo "âœ… Mirror completed successfully!"
          
          # Clean up
          cd /
          rm -rf /tmp/mirror
