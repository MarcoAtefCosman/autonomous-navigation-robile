name: Mirror to Personal Repo

on: [push]

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Verify secret exists
        run: |
          if [ -n "${{ secrets.PERSONAL_REPO_TOKEN }}" ]; then
            echo "✅ Secret is set"
            # Show first 4 chars of token (safe for debugging)
            TOKEN="${{ secrets.PERSONAL_REPO_TOKEN }}"
            echo "Token prefix: ${TOKEN:0:4}..."
          else
            echo "❌ Secret PERSONAL_REPO_TOKEN is not set"
            exit 1
          fi
      
      - name: Configure git
        run: |
          git config --global user.name "MarcoAtefCosman"
          git config --global user.email "your-email@example.com"
      
      - name: Push to personal repo
        run: |
          # Add remote with token in URL - DIRECT reference
          echo "Adding remote..."
          git remote add personal https://MarcoAtefCosman:${{ secrets.PERSONAL_REPO_TOKEN }}@github.com/MarcoAtefCosman/autonomous-navigation-robile.git
          
          # Verify remote
          echo "Remote configured:"
          git remote -v
          
          # Push everything
          echo "Pushing to personal repository..."
          git push --tags --force --prune personal "refs/remotes/origin/*:refs/heads/*"
          
          echo "✅ Mirror completed successfully!"
